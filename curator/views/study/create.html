{{response.title = "Add Study"}}

{{left_sidebar_enabled,right_sidebar_enabled=False,False}}
{{response.subtitle = "import options and licensing"}}

{{### Add support scripts as in single-page editor?}}

{{extend 'layout.html'}}

<style type="text/css">
body {
    overflow-y: scroll;
}
</style>

<div class="row">
 <div class="span8 wireframe">
  <p>
    To support Open Tree's requirements <em>[OR mission? priorities?
    values?]</em> for quality and reproducibility, all submitted trees must
    be associated with a published article, and supporting data must be freely
    available. 
  </p>
  <p>
    Let's begin by getting more information on the published study. 
    <em>[Is it understood that 'study' and 'article' are synonymous?]</em>
  </p>
<!--
  <p>
    We may be able to import the study and tree data automatically. Select its
    current location, then choose an appropriate import method. These are listed
    in order of the required amount of curation, with the easiest methods first. 
  </p>
-->

  <form id="import-from-locations" class="form-inline" style="Xdisplay: none; padding-bottom: 24px;" action=".">
{{ if False: }}
    <h3>Data location</h3>

    <!-- WAS import-option-TREEBASE -->
    <label for="import-from-TREEBASE" class="featured-label">
        <input type="radio" id="import-from-TREEBASE" name="import-from-location" value="IMPORT_FROM_TREEBASE" />
        The data exists in TreeBASE
    </label>
    <!-- WAS import-option-PUBLICATION_DOI -->
    <label for="import-from-ANOTHER_ARCHIVE" class="featured-label">
        <input type="radio" id="import-from-ANOTHER_ARCHIVE" name="import-from-location" value="IMPORT_FROM_ANOTHER_ARCHIVE" />
        The data exists in another data archive
    </label>
    <!-- WAS import-option-NEXML -->
    <label for="import-from-UPLOAD" class="featured-label">
        <input type="radio" id="import-from-UPLOAD" name="import-from-location" value="IMPORT_FROM_UPLOAD" />
        The data only exists on my local machine and I will upload it
    </label>
    <div id="import-method-UPLOAD_WARNING" class="featured-label-child" 
         style="padding-top: 0px; padding-bottom: 0px;">
        <em class="suggestion-prompt">Please choose a <strong>data licensing</strong> option below.</em>
    </div>
{{ pass }}

  <div style="margin-top: 14px;">
    <p>
        <strong>Is the study in TreeBASE?</strong> Importing from TreeBASE is fast and requires only minimal curation post-import.
    </p>
    <div id="import-method-TREEBASE_ID" class="featured-label-child">
        <input class="span4" type="text" name="treebase-id" placeholder="Enter the TreeBASE ID for this study, if any" 
               style="margin-bottom: 12px;"></input>
{{ if False: }}
        <button class="btn btn-info" onclick="return false;"
               style="margin-bottom: 12px;">Import from TreeBASE</button>
{{ pass }}
    </div>
{{ if False: }}
    <div id="import-method-NEXML" class="featured-label-child">
        <p class="featured-label-description">
            <strong>Importing from NeXML</strong> is quick and also saves time in curation.
        </p>
        <input class="span4" style="margin-bottom: 12px;" type="text" name="nexml-fetch-url" placeholder="Enter a URL where we can fetch this NeXML"></input>
        {{
          # To add a proper upload-file widget, see #tree-import-form in views/study/edit.html 
          # and the supporting logic in static/js/study-editor.js
        }}
        <textarea class="span4" name="nexml-pasted-string" placeholder="...or paste the complete NeXML string here" rows="4" style="display: block; margin-bottom: 12px;"></textarea>
        <button class="btn btn-info" style="margin-bottom: 12px;">Import from NeXML</button>
    </div>
{{ pass }}

{{ if False: }}
    <p>
        [If the study has a TreeBASE ID, that's all we need to get started.
        Just click <strong>Continue</strong> below.]
    </p>
{{ pass }}
    <p>
    Most published articles have a <strong>DOI</strong>, or digital object
    identifier. This is assigned by the publisher and usually looks like 
    <span style="font-weight: bold;">10.123/4567</span>, or in URL form 
    <span style="font-weight: bold;">http://dx.doi.org/10.123/4567</span>. 
    If there's no DOI for this study, a permanent URL is also acceptable.
    </p>
    <div id="import-method-PUBLICATION_DOI" class="featured-label-child">
        <input class="span4" type="text" name="publication-DOI" placeholder="Enter the publication DOI (or other permanent URL)" style="margin-bottom: 12px;"></input>
{{ if False: }}
        <button class="btn btn-info" style="margin-bottom: 12px;">Import using publication DOI</button>
{{ pass }}
    </div>
    <p>
        Enter a complete <strong>reference string</strong> for the published article. 
        We can use this, along with a DOI above, to retrieve study metadata automatically.
        <em>[What citation format(s) are acceptable here?]</em>
    </p>
    <div id="import-method-PUBLICATION_REFERENCE" class="featured-label-child">
        <textarea class="span4" name="publication-reference" placeholder="Enter the reference string for this study" rows="4" style="margin-bottom: 12px;"></textarea>
{{ if False: }}
        <button class="btn btn-info" style="vertical-align: bottom; margin-bottom: 12px;">Import using reference string</button>
{{ pass }}
    </div>
{{ if False: }}
    <div id="import-method-MANUAL_ENTRY" class="featured-label-child">
        <p class="featured-label-description">
            <strong>Entering all data manually</strong> is a last resort.
            This rarely needed for recently-published papers.
        </p>
        <button class="btn btn-info">Enter study data manually</button>
    </div>
{{ pass }}
  </div>

{{ if False: }}
  </form>

  <form id="import-method-UPLOAD_LICENSE" class="form-inline" 
        style="padding-bottom: 24px;" action=".">
    <h3>Data licensing</h3>
{{ pass }}
    <p>
        Finally, is the <strong>tree data publicly available</strong> 
        for this study? While we believe that this is generally true for scientific data, 
        we'd prefer to mark each study's data with the
        <a href="http://creativecommons.org/about/cc0" target="_blank">Creative
        Commons Zero (CC0) waiver</a> to affirm that it's in the public domain.
        This allows us to facilitate the permanent archival of tree data
        into our <a href="http://datadryad.org/" target="_blank">partner repository</a>. 
        (Note that this is <em>not</em> a requirement for contributing data to Open
        Tree, just for the archiving feature.)
    </p>

    <div class="featured-label-child">
        <label for="treebase-data-has-CC0" class="featured-label" style="margin-top: 0px;">
            <input type="radio" id="treebase-data-has-CC0" name="data-license" value="treebase-data-has-CC0"/>
             The tree data is stored in TreeBASE and therefore already has the CC0 waiver applied.
        </label>
        <label for="tree-data-has-another-license" class="featured-label">
            <input type="radio" id="tree-data-has-another-license" name="data-license" 
                   value="tree-data-has-another-license"/>
             The tree data already has another license applied (specified below).
        </label>
            <div id="alternate-license-details" class="featured-label-child" style="display: none;">
                <select id="alternate-license" name="alternate-license" style="margin-bottom: 12px;">
                    <option value="">Select the existing license</option>
                    <option value="CC-BY">CC-BY</option>
                    <option value="OTHER">Other</option>
                </select>
                <div id="other-license-info">
                    <input class="span3" type="text" name="data-license-name" 
                           placeholder="Enter the name of this license"></input>
                    <input class="span3" type="text" name="data-license-url" 
                           placeholder="Enter the preferred URL for this license"></input>
                </div>
            </div>
        <label for="agreed-to-CC0" class="featured-label">
            <input type="radio" id="agreed-to-CC0" name="data-license" value="agreed-to-CC0"/>
             The tree data is currently unlicensed. By choosing this option, I
             am agreeing to release this data under the Creative Commons Zero
             (CC0) waiver.
        </label>
        <label for="submit-without-CC0" class="featured-label">
            <input type="radio" id="submit-without-CC0" name="data-license" value="submit-without-CC0"/>
            The tree data is unlicensed, and I'm unable to secure the authors' permission for a CC0 waiver. 
            I would like to contribute this unlicensed data anyway.
        </label>
    </div>

    <button id="continue-button" class="btn btn-info pull-right" 
            style="margin-bottom: 12px;">Continue</button>
  </form>

 </div>
</div>

{{ if False: }}
<div class="row">
    <div class="span8 wireframe"><!-- not too wide... -->
       {main column}
    </div><!-- end of main col -->

    <div class="span4 wireframe">
        {sidebar}
    </div><!-- end of right col -->
</div><!-- /.row -->
{{ pass }}

<script type='text/javascript'>
    var authorName = '{{= auth.user and auth.user.name or 'ANONYMOUS' }}';
    var authorSafeID = '{{= auth.user and auth.user.username.encode('ascii', 'ignore') or 'ANONYMOUS' }}';
    var authorEmail = '{{= auth.user and auth.user.email or 'ANONYMOUS' }}';
    var authToken = '{{= auth.user and auth.user.github_auth_token or 'ANONYMOUS'}}';
    var API_create_study_POST_url = '{{=API_create_study_POST_url}}';
        // this can take a few possible POSTed arguments (DOI, or initial input)
</script>
<script src="{{=URL('static','js/curation-helpers.js')}}"></script>
<script src="{{=URL('static','js/study-creation.js')}}"></script>
